<?php
/**
 * Hyvä Themes - https://hyva.io
 * Copyright © Hyvä Themes 2020-present. All rights reserved.
 * This product is licensed per Magento install
 * See https://hyva.io/license
 */

declare(strict_types=1);

use Hyva\Theme\ViewModel\HyvaCsp;
use Magento\Framework\View\Element\Template;

/** @var HyvaCsp $hyvaCsp */
/** @var Template $block */
?>
<script>
    'use strict';

    (() => {
        document.querySelectorAll('[data-content-type="tab-item"]').forEach(tabItem => {
            tabItem.setAttribute('data-tab-id', tabItem.id);
            tabItem.setAttribute('x-show', 'showTab');
        });

        document.querySelectorAll('[data-content-type="tabs"]').forEach(tab => {
            const defaultActiveTab = parseInt(tab.dataset.activeTab) || 0;

            tab.querySelectorAll('.tab-header').forEach((tabHeader, index) => {
                const tabLink = tabHeader.querySelector('a');
                const tabId = tabLink.getAttribute('href').replace('#', '');

                tabHeader.setAttribute('data-tab-id', tabId);
                tabHeader.setAttribute(':class', 'getHeaderClasses');

                tabLink.setAttribute('data-tab-id', tabId);
                tabLink.setAttribute('x-on:click.prevent', 'setActiveTab');

                if (index === defaultActiveTab) {
                    tab.setAttribute('data-tab-id', tabId);
                    tab.setAttribute('x-data', 'hyvaPageBuilderWidgetsTabs');
                }
            });
        });
    })();

    function hyvaPageBuilderWidgetsTabs() {
        return {
            tab: this.dataset.tabId,

            isActiveTab() {
                return this.tab === this.$el.dataset.tabId;
            },
            setActiveTab() {
                this.tab = this.$el.dataset.tabId
            },
            getHeaderClasses() {
                return {
                    'active': this.this.isActiveTab.call(this)
                };
            },
        }
    }
    window.addEventListener('alpine:init', () => Alpine.data('hyvaPageBuilderWidgetsTabs', hyvaPageBuilderWidgetsTabs), {once: true});
</script>
<?php $hyvaCsp->registerInlineScript() ?>
